modules:
  # Paths to check when creating modules for all module sets
  prefix_inspections:
    bin:
      - PATH
    man:
      - MANPATH
    share/man:
      - MANPATH
    share/aclocal:
      - ACLOCAL_PATH
    lib/pkgconfig:
      - PKG_CONFIG_PATH
    lib64/pkgconfig:
      - PKG_CONFIG_PATH
    share/pkgconfig:
      - PKG_CONFIG_PATH
    "":
      - CMAKE_PREFIX_PATH

  default:
    # uncomment me to start making modulefiles for production
    #roots:
    #  lmod: /modules/spack/share/spack/lmod/

    # two colons means "I mean business"
    enable::
      - lmod
    # still not getting arch folders, I don't know why
    arch_folder: true
    lmod:
      core_compilers:
      # this is hard coded into the spack source so that it's not "Core" it's "gcc-9.4.0"
      - "gcc@9.4.0"
      hierarchy:
      - mpi
      - blas
      hash_length: 0
      projections:
        # MODULE NAME CONFLICT RESOLUTION
        mpc: "{name}/{version}-{hash:3}"
        libpciaccess: "{name}/{version}-{hash:3}"
        pkgconf: "{name}/{version}-{hash:3}"

        cudnn: "{name}/{version}" # don't want "cudnn/8.2.4.15-11.4+cuda11.4.2"
        ^cuda^ucx: "{name}/{version}+cuda{^cuda.version}+ucx"
        ^ucx: "{name}/{version}+ucx"
        ^cuda: "{name}/{version}+cuda{^cuda.version}"
        all: "{name}/{version}"

      all:
        suffixes:
          ~mpi: "no-mpi"
        # don't allow two modules with the same name to be loaded at the same time
        conflict: ["{name}"]
        # The CMake find_package command, such as `find_package(mypkg)`
        # will search the environment for the mypkg_ROOT environment variable.
        # This would really help make the CMake experience much smoother.
        environment:
          set:
            "{name}_ROOT": "{prefix}"

  ###################### MODULE NAME CONFLICT RESOLUTION ##########################
      openmpi:
        suffixes:
          +legacylaunchers: "mpirun"
      openblas:
        suffixes:
          +ilp64: "ilp64"
      boost:
        suffixes:
          +system: "system"
      hdf5:
        suffixes:
          +hl: "hl"
      cairo:
        suffixes:
          +gobject: "gob"

  ################################ BUGFIXES ########################################
      ncurses:
        filter:
          environment_blacklist: ["LD_LIBRARY_PATH"]

  ############################# CUSTOM ENV. VARS #####################################
      apptainer:
        environment:
          set:
            APPTAINER_BINDPATH: "/work,/home,/nese,/project,/gypsum,/scratch,/modules,/nas,/datasets"
      singularity:
        environment:
          set:
            SINGULARITY_BINDPATH: "/work,/home,/nese,/project,/gypsum,/scratch,/modules,/nas,/datasets"
