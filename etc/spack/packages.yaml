packages:
  all:
    # TODO make sure package-maintainer loses write privileges to installs
    permissions:
      read: world
      write: user
      group: package-maintainer
    # despite that there is only one compiler in the list, spack will still decide to
    # use other compilers that it finds in compilers.yaml
    compiler: [gcc@9.4.0]
    # IF WE'RE USING ENVIRONMENTS ANYMORE, be sure that these providers are up
    # to date with the lists in spack.yaml
    providers:
      mpi: [openmpi]
      blas: [openblas]
    variants:
    #- "cuda_arch=52,61,70,75,80,86" # the ones we have in unity as of 8/2022
    - "cuda_arch=52,53,60,61,62,70,72,75,80,86" # all existing arches >= 52 as of 8/2022

  ################################ BUGFIXES ########################################
  # raises error, cannot set suid with group writable
  openssh:
    permissions:
      write: user

  ############################# REQUIRED VARIANTS ####################################
  openmpi:
    variants:
    # default mpi would like our slurm to have pmix but it doesn't, it'll have to make do with pmi
    - "+pmi"
    - "schedulers=slurm"
    - "+legacylaunchers"

  ################################## EXTERNALS #########################################
  # IF WE'RE USING ENVIRONMENTS ANYMORE, be sure that these externals are up
  # to date with the list in spack.yaml

  # the texlive spack install was broken at the time
  texlive:
    version: [20220000]
    buildable: false
    externals:
    - spec: texlive@20220000
      modules:
      - texlive/2022
  # it's important that we all use the same slurm
  slurm:
    version: [20.02.7]
    buildable: false
    externals:
    - spec: slurm@20.02.7
      prefix: /usr
  # this was part of getting openmpi to work, don't know what would happen if we removed it
  pmix:
    version: [3.1.5-1]
    buildable: false
    externals:
    - spec: pmix@3.1.5-1
      prefix: /usr/lib/x86_64-linux-gnu/pmix/
  # system compiler
  gcc:
    version: [9.4.0]
    buildable: false
    externals:
    - spec: gcc@9.4.0
      prefix: /usr
